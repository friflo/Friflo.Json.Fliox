{
    "$comment": "Generated by: https://github.com/friflo/Friflo.Json.Fliox#schema",
    "definitions": {
        "ProtocolMessage": {
            "discriminator": "msg",
            "mapping": {
                "sync":  { "ref":  "SyncRequest" },
                "resp":  { "ref":  "SyncResponse" },
                "error": { "ref":  "ErrorResponse" },
                "ev":    { "ref":  "EventMessage" }
            },
            "properties": {

            }
        },
        "SyncRequest": {
            "properties": {
                "req":      { "type": "int32", "nullable": true },
                "clt":      { "type": "string", "nullable": true },
                "user":     { "type": "string", "nullable": true },
                "token":    { "type": "string", "nullable": true },
                "ack":      { "type": "int32", "nullable": true },
                "tasks":    { "elements": { "ref":  "SyncRequestTask" } },
                "database": { "type": "string", "nullable": true },
                "info":     { "nullable": true }
            }
        },
        "ProtocolRequest": {
            "discriminator": "msg",
            "mapping": {
                "sync": { "ref":  "SyncRequest" }
            },
            "properties": {
                "req": { "type": "int32", "nullable": true },
                "clt": { "type": "string", "nullable": true }
            }
        },
        "SyncRequestTask": {
            "discriminator": "task",
            "mapping": {
                "create":           { "ref":  "CreateEntities" },
                "upsert":           { "ref":  "UpsertEntities" },
                "read":             { "ref":  "ReadEntities" },
                "query":            { "ref":  "QueryEntities" },
                "aggregate":        { "ref":  "AggregateEntities" },
                "patch":            { "ref":  "PatchEntities" },
                "delete":           { "ref":  "DeleteEntities" },
                "message":          { "ref":  "SendMessage" },
                "command":          { "ref":  "SendCommand" },
                "closeCursors":     { "ref":  "CloseCursors" },
                "subscribeChanges": { "ref":  "SubscribeChanges" },
                "subscribeMessage": { "ref":  "SubscribeMessage" },
                "reserveKeys":      { "ref":  "ReserveKeys" }
            },
            "properties": {
                "info": { "nullable": true }
            }
        },
        "CreateEntities": {
            "properties": {
                "info":          { "nullable": true },
                "container":     { "type": "string" },
                "reservedToken": { "ref":  "Guid", "nullable": true },
                "keyName":       { "type": "string", "nullable": true },
                "entities":      { "elements": {  } }
            }
        },
        "UpsertEntities": {
            "properties": {
                "info":      { "nullable": true },
                "container": { "type": "string" },
                "keyName":   { "type": "string", "nullable": true },
                "entities":  { "elements": {  } }
            }
        },
        "ReadEntities": {
            "properties": {
                "info":       { "nullable": true },
                "container":  { "type": "string" },
                "keyName":    { "type": "string", "nullable": true },
                "isIntKey":   { "type": "boolean", "nullable": true },
                "ids":        { "elements": { "type": "string" } },
                "references": { "elements": { "ref":  "References" }, "nullable": true }
            }
        },
        "References": {
            "properties": {
                "selector":   { "type": "string" },
                "container":  { "type": "string" },
                "keyName":    { "type": "string", "nullable": true },
                "isIntKey":   { "type": "boolean", "nullable": true },
                "references": { "elements": { "ref":  "References" }, "nullable": true }
            }
        },
        "QueryEntities": {
            "properties": {
                "info":       { "nullable": true },
                "container":  { "type": "string" },
                "keyName":    { "type": "string", "nullable": true },
                "isIntKey":   { "type": "boolean", "nullable": true },
                "filterTree": { "nullable": true },
                "filter":     { "type": "string", "nullable": true },
                "references": { "elements": { "ref":  "References" }, "nullable": true },
                "limit":      { "type": "int32", "nullable": true },
                "maxCount":   { "type": "int32", "nullable": true },
                "cursor":     { "type": "string", "nullable": true }
            }
        },
        "AggregateEntities": {
            "properties": {
                "info":       { "nullable": true },
                "container":  { "type": "string" },
                "type":       { "ref":  "AggregateType" },
                "filterTree": { "nullable": true },
                "filter":     { "type": "string", "nullable": true }
            }
        },
        "AggregateType": {
            "enum": [
                "count"
            ]
        },
        "PatchEntities": {
            "properties": {
                "info":      { "nullable": true },
                "container": { "type": "string" },
                "keyName":   { "type": "string", "nullable": true },
                "patches":   { "elements": { "ref":  "EntityPatch" } }
            }
        },
        "EntityPatch": {
            "properties": {
                "id":      { "type": "string" },
                "patches": { "elements": { "ref":  "JsonPatch" } }
            }
        },
        "JsonPatch": {
            "discriminator": "op",
            "mapping": {
                "replace": { "ref":  "PatchReplace" },
                "add":     { "ref":  "PatchAdd" },
                "remove":  { "ref":  "PatchRemove" },
                "copy":    { "ref":  "PatchCopy" },
                "move":    { "ref":  "PatchMove" },
                "test":    { "ref":  "PatchTest" }
            },
            "properties": {

            }
        },
        "PatchReplace": {
            "properties": {
                "path":  { "type": "string" },
                "value": {  }
            }
        },
        "PatchAdd": {
            "properties": {
                "path":  { "type": "string" },
                "value": {  }
            }
        },
        "PatchRemove": {
            "properties": {
                "path": { "type": "string" }
            }
        },
        "PatchCopy": {
            "properties": {
                "path": { "type": "string" },
                "from": { "type": "string", "nullable": true }
            }
        },
        "PatchMove": {
            "properties": {
                "path": { "type": "string" },
                "from": { "type": "string", "nullable": true }
            }
        },
        "PatchTest": {
            "properties": {
                "path":  { "type": "string" },
                "value": { "nullable": true }
            }
        },
        "DeleteEntities": {
            "properties": {
                "info":      { "nullable": true },
                "container": { "type": "string" },
                "ids":       { "elements": { "type": "string" }, "nullable": true },
                "all":       { "type": "boolean", "nullable": true }
            }
        },
        "SendMessage": {
            "properties": {
                "info":    { "nullable": true },
                "name":    { "type": "string" },
                "param":   { "nullable": true },
                "users":   { "elements": { "type": "string" }, "nullable": true },
                "clients": { "elements": { "type": "string" }, "nullable": true },
                "groups":  { "elements": { "type": "string" }, "nullable": true }
            }
        },
        "SyncMessageTask": {
            "properties": {
                "info":    { "nullable": true },
                "name":    { "type": "string" },
                "param":   { "nullable": true },
                "users":   { "elements": { "type": "string" }, "nullable": true },
                "clients": { "elements": { "type": "string" }, "nullable": true },
                "groups":  { "elements": { "type": "string" }, "nullable": true }
            }
        },
        "SendCommand": {
            "properties": {
                "info":    { "nullable": true },
                "name":    { "type": "string" },
                "param":   { "nullable": true },
                "users":   { "elements": { "type": "string" }, "nullable": true },
                "clients": { "elements": { "type": "string" }, "nullable": true },
                "groups":  { "elements": { "type": "string" }, "nullable": true }
            }
        },
        "CloseCursors": {
            "properties": {
                "info":      { "nullable": true },
                "container": { "type": "string" },
                "cursors":   { "elements": { "type": "string" }, "nullable": true }
            }
        },
        "SubscribeChanges": {
            "properties": {
                "info":      { "nullable": true },
                "container": { "type": "string" },
                "changes":   { "elements": { "ref":  "EntityChange" } },
                "filter":    { "type": "string", "nullable": true }
            }
        },
        "EntityChange": {
            "enum": [
                "create",
                "upsert",
                "patch",
                "delete"
            ]
        },
        "SubscribeMessage": {
            "properties": {
                "info":   { "nullable": true },
                "name":   { "type": "string" },
                "remove": { "type": "boolean", "nullable": true }
            }
        },
        "ReserveKeys": {
            "properties": {
                "info":      { "nullable": true },
                "container": { "type": "string" },
                "count":     { "type": "int32" }
            }
        },
        "SyncResponse": {
            "properties": {
                "req":        { "type": "int32", "nullable": true },
                "clt":        { "type": "string", "nullable": true },
                "database":   { "type": "string", "nullable": true },
                "tasks":      { "elements": { "ref":  "SyncTaskResult" }, "nullable": true },
                "containers": { "elements": { "ref":  "ContainerEntities" }, "nullable": true },
                "info":       { "nullable": true }
            }
        },
        "ProtocolResponse": {
            "discriminator": "msg",
            "mapping": {
                "resp":  { "ref":  "SyncResponse" },
                "error": { "ref":  "ErrorResponse" }
            },
            "properties": {
                "req": { "type": "int32", "nullable": true },
                "clt": { "type": "string", "nullable": true }
            }
        },
        "SyncTaskResult": {
            "discriminator": "task",
            "mapping": {
                "create":           { "ref":  "CreateEntitiesResult" },
                "upsert":           { "ref":  "UpsertEntitiesResult" },
                "read":             { "ref":  "ReadEntitiesResult" },
                "query":            { "ref":  "QueryEntitiesResult" },
                "aggregate":        { "ref":  "AggregateEntitiesResult" },
                "patch":            { "ref":  "PatchEntitiesResult" },
                "delete":           { "ref":  "DeleteEntitiesResult" },
                "message":          { "ref":  "SendMessageResult" },
                "command":          { "ref":  "SendCommandResult" },
                "closeCursors":     { "ref":  "CloseCursorsResult" },
                "subscribeChanges": { "ref":  "SubscribeChangesResult" },
                "subscribeMessage": { "ref":  "SubscribeMessageResult" },
                "reserveKeys":      { "ref":  "ReserveKeysResult" },
                "error":            { "ref":  "TaskErrorResult" }
            },
            "properties": {

            }
        },
        "CreateEntitiesResult": {
            "properties": {
                "errors": { "elements": { "ref":  "EntityError" }, "nullable": true }
            }
        },
        "EntityError": {
            "properties": {
                "id":      { "type": "string" },
                "type":    { "ref":  "EntityErrorType" },
                "message": { "type": "string", "nullable": true }
            }
        },
        "EntityErrorType": {
            "enum": [
                "Undefined",
                "ParseError",
                "ReadError",
                "WriteError",
                "DeleteError",
                "PatchError"
            ]
        },
        "UpsertEntitiesResult": {
            "properties": {
                "errors": { "elements": { "ref":  "EntityError" }, "nullable": true }
            }
        },
        "ReadEntitiesResult": {
            "properties": {
                "references": { "elements": { "ref":  "ReferencesResult" }, "nullable": true }
            }
        },
        "ReferencesResult": {
            "properties": {
                "error":      { "type": "string", "nullable": true },
                "container":  { "type": "string", "nullable": true },
                "count":      { "type": "int32", "nullable": true },
                "ids":        { "elements": { "type": "string" } },
                "references": { "elements": { "ref":  "ReferencesResult" }, "nullable": true }
            }
        },
        "QueryEntitiesResult": {
            "properties": {
                "container":  { "type": "string", "nullable": true },
                "cursor":     { "type": "string", "nullable": true },
                "count":      { "type": "int32", "nullable": true },
                "ids":        { "elements": { "type": "string" } },
                "references": { "elements": { "ref":  "ReferencesResult" }, "nullable": true }
            }
        },
        "AggregateEntitiesResult": {
            "properties": {
                "container": { "type": "string", "nullable": true },
                "value":     { "type": "double", "nullable": true }
            }
        },
        "PatchEntitiesResult": {
            "properties": {
                "errors": { "elements": { "ref":  "EntityError" }, "nullable": true }
            }
        },
        "DeleteEntitiesResult": {
            "properties": {
                "errors": { "elements": { "ref":  "EntityError" }, "nullable": true }
            }
        },
        "SendMessageResult": {
            "properties": {

            }
        },
        "SyncMessageResult": {
            "properties": {

            }
        },
        "SendCommandResult": {
            "properties": {
                "result": { "nullable": true }
            }
        },
        "CloseCursorsResult": {
            "properties": {
                "count": { "type": "int32" }
            }
        },
        "SubscribeChangesResult": {
            "properties": {

            }
        },
        "SubscribeMessageResult": {
            "properties": {

            }
        },
        "ReserveKeysResult": {
            "properties": {
                "keys": { "ref":  "ReservedKeys", "nullable": true }
            }
        },
        "ReservedKeys": {
            "properties": {
                "start": { "type": "int64" },
                "count": { "type": "int32" },
                "token": { "ref":  "Guid" }
            }
        },
        "TaskErrorResult": {
            "properties": {
                "type":       { "ref":  "TaskErrorResultType" },
                "message":    { "type": "string", "nullable": true },
                "stacktrace": { "type": "string", "nullable": true }
            }
        },
        "TaskErrorResultType": {
            "enum": [
                "None",
                "UnhandledException",
                "DatabaseError",
                "FilterError",
                "ValidationError",
                "CommandError",
                "InvalidTask",
                "NotImplemented",
                "PermissionDenied",
                "SyncError"
            ]
        },
        "ContainerEntities": {
            "properties": {
                "container": { "type": "string" },
                "count":     { "type": "int32", "nullable": true },
                "entities":  { "elements": {  } },
                "notFound":  { "elements": { "type": "string" }, "nullable": true },
                "errors":    { "elements": { "ref":  "EntityError" }, "nullable": true }
            }
        },
        "ErrorResponse": {
            "properties": {
                "req":     { "type": "int32", "nullable": true },
                "clt":     { "type": "string", "nullable": true },
                "message": { "type": "string", "nullable": true },
                "type":    { "ref":  "ErrorResponseType" }
            }
        },
        "ErrorResponseType": {
            "enum": [
                "BadRequest",
                "Exception",
                "BadResponse"
            ]
        },
        "EventMessage": {
            "properties": {
                "clt":    { "type": "string" },
                "events": { "elements": { "ref":  "SyncEvent" }, "nullable": true }
            }
        },
        "ProtocolEvent": {
            "discriminator": "msg",
            "mapping": {
                "ev": { "ref":  "EventMessage" }
            },
            "properties": {
                "clt": { "type": "string" }
            }
        },
        "SyncEvent": {
            "properties": {
                "seq":      { "type": "int32" },
                "src":      { "type": "string" },
                "isOrigin": { "type": "boolean", "nullable": true },
                "db":       { "type": "string" },
                "tasks":    { "elements": { "ref":  "SyncRequestTask" }, "nullable": true }
            }
        }
    }
}

